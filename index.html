<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>PlayJEGUE Stream Bar (Fix)</title>
<style>
    :root{
        --bar-radius: 26px;
        --bar-h: 56px;
        --bar-padding: 8px;
        --platform-color: #7c3aed; /* default (Twitch) */
        --platform-color-dark: #5b2db5;
        --text: #fff;
        --muted: #cfcfcf;
        --ui: #2a2a2a;
        --ui-2:#1f1f1f;
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{
        margin:0;
        padding:16px;
        background:#111;
        color:var(--text);
        font-family: system-ui, -apple-system, "Segoe UI", Roboto, Ubuntu, Cantarell, "Helvetica Neue", Arial, "Noto Sans", "Apple Color Emoji","Segoe UI Emoji", "Segoe UI Symbol";
        display:flex;flex-direction:column;align-items:center;gap:16px
    }

    /* ===== BAR ===== */
    .wrap{position:relative}
    .stream-bar{
        width:min(460px, 96vw);
        height:var(--bar-h);
        border-radius:var(--bar-radius);
        display:flex;align-items:center;gap:8px;
        padding:0 var(--bar-padding);
        background: linear-gradient(90deg, var(--platform-color) 0%, var(--platform-color-dark) 100%);
        box-shadow: 0 10px 24px rgba(0,0,0,.35);
        position:relative;overflow:hidden;
        transition: background .5s ease;
        will-change: transform;
        animation: barBounce 3.2s ease-in-out infinite;
    }
    /* subtle bounce */
    @keyframes barBounce {
        0%,100%{transform: translateY(0)}
        50%{transform: translateY(-2.5px)}
    }

    /* GLOW ring (toggleable) */
    .glow:before{
        content:"";
        position:absolute;inset:-3px;
        border-radius: calc(var(--bar-radius) + 4px);
        padding:3px;
        --c: var(--platform-color);
        background:
          conic-gradient(from var(--glow-rot, 0deg), #fff 0 8%, transparent 8% 25%, var(--c) 25% 40%, transparent 40% 100%);
        -webkit-mask: 
          linear-gradient(#000 0 0) content-box, 
          linear-gradient(#000 0 0);
        -webkit-mask-composite: xor; mask-composite: exclude;
        animation: spin 6s linear infinite;
        pointer-events:none;
    }
    @keyframes spin { to { --glow-rot: 360deg } }

    /* optional shadow */
    .shadow{ box-shadow: 0 18px 40px rgba(0,0,0,.55); }

    .logo-box{width:40px;height:40px;border-radius:50%;background:rgba(255,255,255,.08);
        display:grid;place-items:center;flex:0 0 auto; position:relative;
        transition: transform .35s cubic-bezier(.22,1,.36,1);
    }
    .logo{width:26px;height:26px;fill:#fff;display:block}
    .username{flex:1;min-width:0;font-weight:700;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
    .counters{display:flex;align-items:center;gap:10px;margin-left:auto}
    .counter-group{display:flex;align-items:center;gap:6px}
    .counter{font-weight:800;font-size:18px}
    .divider{width:1px;height:26px;background:rgba(255,255,255,.35);}

    /* Better icons */
    .skull{width:22px;height:22px}
    .trophy{width:22px;height:22px}

    /* ===== CONTROLS (Dock) ===== */
    .panel{
        width:min(900px, 96vw);
        background:var(--ui);
        border-radius:16px;
        padding:14px;
        display:flex;flex-direction:column;gap:14px
    }
    .title{font-weight:800;letter-spacing:.3px;opacity:.95}
    .tabs{display:flex;gap:8px;flex-wrap:wrap}
    .tab-btn{background:var(--ui-2);border:none;color:#fff;padding:8px 10px;border-radius:10px;cursor:pointer;opacity:.85}
    .tab-btn.active{outline:2px solid var(--platform-color);opacity:1}
    .tab{display:none;gap:16px}
    .tab.active{display:flex}
    .row{display:flex;gap:10px;flex-wrap:wrap}
    .card{background:#181818;border:1px solid #2a2a2a;border-radius:12px;padding:12px;flex:1;min-width:260px}
    .label{font-size:12px;opacity:.85;margin-bottom:6px}
    .field{display:flex;align-items:center;gap:8px}
    input[type="text"], input[type="number"], input[type="url"], input[type="color"]{
        background:#111;border:1px solid #2c2c2c;border-radius:8px;padding:8px;color:#fff;min-width:0;flex:1
    }
    .toggle{width:44px;height:26px;border-radius:999px;background:#333;position:relative;cursor:pointer;flex:0 0 auto}
    .toggle:before{content:"";position:absolute;inset:3px;width:20px;height:20px;border-radius:50%;background:#aaa;transition:transform .25s}
    .toggle.on{background:#37c977}
    .toggle.on:before{transform: translateX(18px);background:#fff}
    .btn{background:#303030;border:1px solid #3a3a3a;color:#fff;border-radius:10px;padding:8px 10px;cursor:pointer}
    .platform-list{display:flex;flex-direction:column;gap:10px;max-height:320px;overflow:auto}
    .plat-item{display:grid;grid-template-columns:36px 1fr auto auto auto;align-items:center;gap:10px;background:#141414;border:1px solid #252525;padding:8px;border-radius:10px}
    .plat-logo{width:24px;height:24px}
    .subtabs{display:flex;gap:6px;margin-bottom:8px}
    .subtab-btn{background:#202020;border:1px solid #2a2a2a;color:#ddd;border-radius:8px;padding:6px 8px;cursor:pointer;font-size:12px}
    .subtab-btn.active{background:#2b2b2b;color:#fff;outline:1px solid #3f3f3f}
    small.muted{color:#bbb;opacity:.9}
</style>
</head>
<body>
    <div class="wrap">
        <div id="bar" class="stream-bar shadow">
            <div class="logo-box" id="logoBox">
                <svg id="logo" class="logo" viewBox="0 0 24 24" aria-hidden="true"></svg>
            </div>
            <div id="username" class="username">@</div>

            <div class="counters">
                <div id="deathGroup" class="counter-group">
                    <!-- Improved Skull -->
                    <svg class="skull" viewBox="0 0 24 24" aria-hidden="true">
                        <defs>
                            <linearGradient id="skg" x1="0" y1="0" x2="1" y2="1">
                                <stop offset="0%" stop-color="#e6e6e6"/>
                                <stop offset="60%" stop-color="#bdbdbd"/>
                                <stop offset="100%" stop-color="#9a9a9a"/>
                            </linearGradient>
                        </defs>
                        <path d="M12 2c4.8 0 8 3.13 8 7.5 0 2.62-1.2 4.27-3.07 5.33v2.17a1 1 0 0 1-1 1h-1v2a1 1 0 0 1-1 1h-6a1 1 0 0 1-1-1v-2H6a1 1 0 0 1-1-1v-2.2C3.99 13.75 4 11.6 4 9.5 4 5.13 7.2 2 12 2Z" fill="url(#skg)"/>
                        <circle cx="9" cy="10" r="1.9" fill="#222"/>
                        <circle cx="15" cy="10" r="1.9" fill="#222"/>
                        <path d="M12 13.5c1.2.1 2 .8 2 1.7s-.8 1.3-2 1.3-2-.4-2-1.3.8-1.6 2-1.7Z" fill="#222" opacity=".75"/>
                    </svg>
                    <span id="death" class="counter">0</span>
                </div>

                <div id="divider" class="divider" style="display:none"></div>

                <div id="trophyGroup" class="counter-group">
                    <!-- PlayStation Platinum Trophy -->
                    <svg class="trophy" viewBox="0 0 64 64" aria-hidden="true">
                        <defs>
                            <linearGradient id="pl" x1="0" y1="0" x2="1" y2="1">
                                <stop offset="0%" stop-color="#f0f0f3"/>
                                <stop offset="40%" stop-color="#ffffff"/>
                                <stop offset="80%" stop-color="#c9c9d3"/>
                            </linearGradient>
                        </defs>
                        <path d="M16 12h32c0 10-3 14-10 16a10 10 0 1 1-12 0c-7-2-10-6-10-16Z" fill="url(#pl)" stroke="#9aa0a6"/>
                        <rect x="28" y="40" width="8" height="6" rx="2" fill="#a7a7b3"/>
                        <rect x="24" y="46" width="16" height="4" rx="2" fill="#9a9aac"/>
                    </svg>
                    <span id="trophy" class="counter">0/1</span>
                </div>
            </div>
        </div>
    </div>

    <!-- Control Panel (for Dock/custom) -->
    <div class="panel" id="panel">
        <div class="title">⚙️ PlayJEGUE Stream Bar — Geral</div>
        <div class="tabs">
            <button class="tab-btn active" data-tab="geral">Geral</button>
            <button class="tab-btn" data-tab="contadores">Contadores</button>
            <button class="tab-btn" data-tab="plataformas">Plataformas</button>
            <button class="tab-btn" data-tab="instrucoes">Instruções</button>
        </div>

        <!-- Geral -->
        <div class="tab active" id="tab-geral">
            <div class="card">
                <div class="label">Efeitos da Barra</div>
                <div class="row">
                    <div class="field">
                        <div class="toggle on" id="toggleShadow"></div>
                        <span>Ativar sombra</span>
                    </div>
                    <div class="field">
                        <div class="toggle on" id="toggleGlow"></div>
                        <span>Ativar Glow (anel giratório)</span>
                    </div>
                </div>
                <div class="row">
                    <button class="btn" id="copyBrowser">Copiar URL (Source)</button>
                    <button class="btn" id="copyDock">Copiar URL (Dock)</button>
                </div>
                <small class="muted">Use a URL com <code>?obs=true</code> para Source e <code>?dock=true</code> para Dock.</small>
            </div>
        </div>

        <!-- Contadores -->
        <div class="tab" id="tab-contadores">
            <div class="card">
                <div class="label">Mortes</div>
                <div class="row">
                    <button class="btn" id="decDeath">-</button>
                    <input id="deathInput" type="number" min="0" value="0"/>
                    <button class="btn" id="incDeath">+</button>
                    <button class="btn" id="resetDeath">Zerar</button>
                    <div class="field">
                        <div class="toggle on" id="toggleDeath"></div><span>Mostrar</span>
                    </div>
                </div>
            </div>
            <div class="card">
                <div class="label">Troféus (atual / platina)</div>
                <div class="row">
                    <button class="btn" id="decT1">-</button>
                    <input id="t1" type="number" min="0" value="0"/>
                    <button class="btn" id="incT1">+</button>
                    <button class="btn" id="decT2">-</button>
                    <input id="t2" type="number" min="1" value="1"/>
                    <button class="btn" id="incT2">+</button>
                    <button class="btn" id="resetT">Zerar</button>
                    <div class="field">
                        <div class="toggle on" id="toggleTrophy"></div><span>Mostrar</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Plataformas -->
        <div class="tab" id="tab-plataformas">
            <div class="card" style="flex:2">
                <div class="label">Usuário Global</div>
                <div class="row">
                    <input id="globalUser" type="text" placeholder="Digite @usuario para aplicar nas plataformas selecionadas"/>
                    <button class="btn" id="applyAll">Aplicar</button>
                </div>

                <div class="subtabs" id="subtabs">
                    <button class="subtab-btn active" data-sub="principais">Principais</button>
                    <button class="subtab-btn" data-sub="consoles">Consoles</button>
                    <button class="subtab-btn" data-sub="redes">Redes</button>
                    <button class="subtab-btn" data-sub="custom">Custom</button>
                </div>

                <div class="platform-list" id="platList"></div>
            </div>

            <div class="card" style="flex:1">
                <div class="label">Adicionar Plataforma (inclui ícone por URL)</div>
                <div class="row">
                    <input id="pName" type="text" placeholder="Nome (ex: TikTok)"/>
                    <input id="pUser" type="text" placeholder="@usuario"/>
                </div>
                <div class="row">
                    <input id="pColor" type="color" value="#6c5ce7"/>
                    <input id="pIconUrl" type="url" placeholder="URL do ícone/imagem (opcional)"/>
                </div>
                <button class="btn" id="addPlatform">+ Adicionar</button>
                <small class="muted">A plataforma "CUSTOM" permite personalizar um ícone/URL livre.</small>
            </div>
        </div>

        <!-- Instruções -->
        <div class="tab" id="tab-instrucoes">
            <div class="card">
                <div class="label">Atalhos de Teclado</div>
                <div>• CMD/CTRL + [ : + Troféu Atual • CMD/CTRL + ] : + Platina • CMD/CTRL + \\ : Zerar Troféus</div>
                <div>• CMD/CTRL + SHIFT + ] : + Mortes • CMD/CTRL + SHIFT + \\ : Zerar Mortes</div>
            </div>
            <div class="card">
                <div class="label">OBS</div>
                <div>Adicione como Browser Source. Acrescente <code>?obs=true</code>. Para Dock, use <code>?dock=true</code>.</div>
            </div>
        </div>
    </div>

<script>
// ---------- STATE ----------
const STORAGE_KEY = "playjegue_stream_data_v2";
const appState = {
    currentTrophy: 0,
    maxTrophy: 1,
    deathCount: 0,
    showDeath: true,
    showTrophy: true,
    glow: true,
    shadow: true,
    // IMPORTANT: default usernames start blank and most platforms disabled on first load
    platforms: [
        // Principais
        {name:"twitch",  label:"Twitch",  username:"", color:"#9146ff", icon:svg.twitch, enabled:false, cat:"principais"},
        {name:"youtube", label:"YouTube", username:"", color:"#ff0000", icon:svg.youtube, enabled:false, cat:"principais"},
        {name:"kick",    label:"Kick",    username:"", color:"#53fc18", icon:svg.kick,    enabled:false, cat:"principais"},
        // Consoles
        {name:"playstation", label:"PlayStation", username:"", color:"#0070d1", icon:svg.playstation, enabled:false, cat:"consoles"},
        {name:"xbox",        label:"Xbox",        username:"", color:"#107c10", icon:svg.xbox,        enabled:false, cat:"consoles"},
        // Redes
        {name:"instagram", label:"Instagram", username:"", color:"#dc2743", icon:svg.instagram, enabled:false, cat:"redes"},
        {name:"tiktok",    label:"TikTok",    username:"", color:"#ff0050", icon:svg.tiktok,    enabled:false, cat:"redes"},
        // Custom placeholder
        {name:"custom", label:"CUSTOM", username:"", color:"#6c5ce7", icon:null, iconUrl:"", enabled:false, cat:"custom"}
    ],
    currentPlatformIndex: 0,
    activeSub:"principais",
    isObs: new URLSearchParams(location.search).get("obs")==="true",
    isDock: new URLSearchParams(location.search).get("dock")==="true"
};

// ---------- ICONS (fixed/improved) ----------
function path(d){ return `<path d="${d}"/>`; }
const svg = {
    // YouTube
    youtube: path("M10 8l6 4-6 4V8zm-8-1.5C2 4 4 4 12 4s10 0 10 2.5V17.5C22 20 20 20 12 20S2 20 2 17.5V6.5z"),
    // Twitch
    twitch: path("M4 2h16v12l-4 4h-4l-2 2H8v-2H4V2zm6 4v6h2V6h-2zm6 0v6h2V6h-2z"),
    // Instagram (glyph)
    instagram: `<rect x="3" y="3" width="18" height="18" rx="5"/><circle cx="12" cy="12" r="4"/>
                <circle cx="17.5" cy="6.5" r="1.5"/>`,
    // TikTok
    tiktok: path("M9 3h3c.1 2.1 1.4 3.8 3.6 4.1V9c-1.8 0-3.2-.6-4.3-1.5V15a5 5 0 1 1-3-9.1V8a2 2 0 1 0 2 2V3z"),
    // Xbox
    xbox: `<path d="M12 2a10 10 0 1 0 10 10A10 10 0 0 0 12 2Zm3.9 5.1a14.6 14.6 0 0 1-3.9 3.2 14.6 14.6 0 0 1-3.9-3.2A6.9 6.9 0 0 1 12 6a6.9 6.9 0 0 1 3.9 1.1Zm-8 1.5a25.3 25.3 0 0 0 4.1 3.4C9 13.8 7.6 16.2 7 19a8 8 0 0 1 .9-10.4ZM16 19c-.6-2.8-2-5.2-5-7a25.3 25.3 0 0 0 4.1-3.4A8 8 0 0 1 19 19Z"/>`,
    // PlayStation (fixed iconic PS "PS" swoosh mark)
    playstation: `<path d="M10 3v14.5c0 1.7-4.5.4-6-.2v-2.6c2 .8 6 2.1 6 .1V8.5l6.6 2.3c2.2.7 3.4 1.6 3.4 3.5 0 2.6-2.8 4-5.7 2.8v-2.4c1.3.6 2.4.4 2.4-.5 0-.6-.6-1-1.8-1.4L10 10.6V3z"/><path d="M22 18.2c-1.5.8-3.9 1.6-6 .8v-2.2c1.5.5 3.2.1 4-.4 1.4-.9.5-1.7-1.6-2.4l-2.4-.7V11l3.1 1c2.7.9 4.3 2.6 2.9 4.2z"/>`,
    // Kick (fixed block K)
    kick: `<path d="M3 3h18v18H3z"/><path d="M8 7h3v4l3-4h3l-3.6 4.5L17 17h-3.2l-3-4v4H8z" fill="#111"/>`
};

// Populate SVG on object creation
// (we needed svg variable earlier in appState; it's fine because functions/const hoist by parsing order)

// ---------- UTIL ----------
function $(q,root=document){return root.querySelector(q)}
function $all(q,root=document){return Array.from(root.querySelectorAll(q))}
function save(){ localStorage.setItem(STORAGE_KEY, JSON.stringify(appState)); }
function load(){
    const raw = localStorage.getItem(STORAGE_KEY);
    if(!raw) return;
    try{
        const data = JSON.parse(raw);
        Object.assign(appState, data);
    }catch(e){}
}
load();

// ---------- BAR RENDER ----------
function setPlatformCss(color){
    document.documentElement.style.setProperty("--platform-color", color);
    // darker
    const c = color.replace("#","");
    const r = Math.max(0, parseInt(c.substr(0,2),16)-40);
    const g = Math.max(0, parseInt(c.substr(2,2),16)-40);
    const b = Math.max(0, parseInt(c.substr(4,2),16)-40);
    document.documentElement.style.setProperty("--platform-color-dark", `#${r.toString(16).padStart(2,"0")}${g.toString(16).padStart(2,"0")}${b.toString(16).padStart(2,"0")}`);
}

function renderBar(){
    const p = getEnabledPlatforms()[appState.currentPlatformIndex] || appState.platforms[0];
    const bar = $("#bar");
    const logo = $("#logo");
    const username = $("#username");
    const divider = $("#divider");
    const deathGroup = $("#deathGroup");
    const trophyGroup = $("#trophyGroup");

    // username & icon
    username.textContent = p?.username || "@";
    logo.innerHTML = p?.icon ? p.icon : (p?.iconUrl ? `<image href="${p.iconUrl}" width="24" height="24" x="0" y="0"/>` : "");

    // color
    setPlatformCss(p?.color || "#7c3aed");

    // counters & divider visibility
    deathGroup.style.display = appState.showDeath ? "flex" : "none";
    trophyGroup.style.display = appState.showTrophy ? "flex" : "none";
    divider.style.display = (appState.showDeath && appState.showTrophy) ? "block" : "none";

    // effects
    $("#bar").classList.toggle("glow", !!appState.glow);
    $("#bar").classList.toggle("shadow", !!appState.shadow);

    // text
    $("#death").textContent = appState.deathCount;
    $("#trophy").textContent = `${appState.currentTrophy}/${appState.maxTrophy}`;
}

function getEnabledPlatforms(){
    return appState.platforms.filter(p=>p.enabled);
}

function rotatePlatform(){
    const list = getEnabledPlatforms();
    if(list.length<=1) return;
    appState.currentPlatformIndex = (appState.currentPlatformIndex+1) % list.length;
    save();
    renderBar();
}

// ---------- CONTROLS ----------
function toggleEl(el){ el.classList.toggle("on"); }

function bindControls(){
    // Tabs
    $all(".tab-btn").forEach(btn=>btn.addEventListener("click", e=>{
        $all(".tab-btn").forEach(b=>b.classList.remove("active"));
        btn.classList.add("active");
        $all(".tab").forEach(t=>t.classList.remove("active"));
        $("#tab-"+btn.dataset.tab).classList.add("active");
    }));

    // Geral toggles
    $("#toggleShadow").addEventListener("click",e=>{
        toggleEl(e.currentTarget);
        appState.shadow = e.currentTarget.classList.contains("on"); save(); renderBar();
    });
    $("#toggleGlow").addEventListener("click",e=>{
        toggleEl(e.currentTarget);
        appState.glow = e.currentTarget.classList.contains("on"); save(); renderBar();
    });

    // Copy URLs
    $("#copyBrowser").addEventListener("click", ()=>{
        navigator.clipboard.writeText(location.origin+location.pathname).catch(()=>{});
    });
    $("#copyDock").addEventListener("click", ()=>{
        navigator.clipboard.writeText(location.origin+location.pathname+"?dock=true").catch(()=>{});
    });

    // Counters
    $("#incDeath").onclick=()=>{appState.deathCount++; save(); renderBar();};
    $("#decDeath").onclick=()=>{appState.deathCount=Math.max(0,appState.deathCount-1); save(); renderBar();};
    $("#resetDeath").onclick=()=>{appState.deathCount=0; save(); renderBar();};
    $("#deathInput").onchange=e=>{appState.deathCount=Math.max(0, +e.target.value||0); save(); renderBar();};

    $("#incT1").onclick=()=>{appState.currentTrophy=Math.min(99, appState.currentTrophy+1); save(); renderBar();};
    $("#decT1").onclick=()=>{appState.currentTrophy=Math.max(0, appState.currentTrophy-1); save(); renderBar();};
    $("#incT2").onclick=()=>{appState.maxTrophy=Math.min(99, appState.maxTrophy+1); if(appState.currentTrophy>appState.maxTrophy) appState.currentTrophy=appState.maxTrophy; save(); renderBar();};
    $("#decT2").onclick=()=>{appState.maxTrophy=Math.max(1, appState.maxTrophy-1); if(appState.currentTrophy>appState.maxTrophy) appState.currentTrophy=appState.maxTrophy; save(); renderBar();};
    $("#resetT").onclick=()=>{appState.currentTrophy=0; appState.maxTrophy=1; save(); renderBar();};
    $("#t1").onchange=e=>{appState.currentTrophy=Math.min(99, Math.max(0, +e.target.value||0)); save(); renderBar();};
    $("#t2").onchange=e=>{appState.maxTrophy=Math.min(99, Math.max(1, +e.target.value||1)); if(appState.currentTrophy>appState.maxTrophy) appState.currentTrophy=appState.maxTrophy; save(); renderBar();};

    $("#toggleDeath").onclick=e=>{toggleEl(e.currentTarget); appState.showDeath = e.currentTarget.classList.contains("on"); save(); renderBar();};
    $("#toggleTrophy").onclick=e=>{toggleEl(e.currentTarget); appState.showTrophy = e.currentTarget.classList.contains("on"); save(); renderBar();};

    // Platforms subtabs
    $all(".subtab-btn").forEach(btn=>btn.addEventListener("click", ()=>{
        $all(".subtab-btn").forEach(b=>b.classList.remove("active"));
        btn.classList.add("active");
        appState.activeSub = btn.dataset.sub; renderPlatforms();
    }));

    // Apply all
    $("#applyAll").onclick=()=>{
        const v = $("#globalUser").value.trim();
        if(!v) return;
        appState.platforms.forEach(p=>{ if(p.cat===appState.activeSub) p.username = v });
        save(); renderPlatforms(); renderBar();
    };

    // Add platform
    $("#addPlatform").onclick=()=>{
        const name = $("#pName").value.trim();
        const user = $("#pUser").value.trim();
        const color = $("#pColor").value;
        const url = $("#pIconUrl").value.trim();
        if(!name || !color) return;
        const id = name.toLowerCase().replace(/\s+/g,"");
        appState.platforms.push({name:id,label:name,username:user,color,icon:null,iconUrl:url,enabled:true,cat:"custom"});
        save(); renderPlatforms();
        $("#pName").value=""; $("#pUser").value=""; $("#pIconUrl").value="";
    };

    // Hotkeys
    document.addEventListener("keydown",(e)=>{
        if(!(e.ctrlKey||e.metaKey)) return;
        if(e.shiftKey){
            if(e.key===']'){ e.preventDefault(); appState.deathCount++; save(); renderBar(); }
            if(e.key==='\\'){ e.preventDefault(); appState.deathCount=0; save(); renderBar(); }
        }else{
            if(e.key==='['){ e.preventDefault(); appState.currentTrophy=Math.min(99, appState.currentTrophy+1); save(); renderBar(); }
            if(e.key===']'){ e.preventDefault(); appState.maxTrophy=Math.min(99, appState.maxTrophy+1); save(); renderBar(); }
            if(e.key==='\\'){ e.preventDefault(); appState.currentTrophy=0; appState.maxTrophy=1; save(); renderBar(); }
        }
    });
}

function renderPlatforms(){
    const list = $("#platList"); list.innerHTML="";
    const filtered = appState.platforms.filter(p=>p.cat===appState.activeSub);
    filtered.forEach((p, idx)=>{
        const i = document.createElement("div");
        i.className = "plat-item";
        i.innerHTML = `
            <svg viewBox="0 0 24 24" class="plat-logo">${p.icon ? p.icon : (p.iconUrl ? `<image href="${p.iconUrl}" width="24" height="24"/>`:"")}</svg>
            <input type="text" value="${p.username||""}" placeholder="@usuario"/>
            <div class="toggle ${p.enabled?'on':''}"></div>
            <input type="color" value="${p.color}"/>
            <button class="btn">Remover</button>
        `;
        const [inp, tog, col, rem] = [i.children[1], i.children[2], i.children[3], i.children[4]];
        inp.onchange = e=>{ p.username = e.target.value.trim(); save(); renderBar(); };
        tog.onclick = ()=>{ tog.classList.toggle("on"); p.enabled = tog.classList.contains("on"); save(); renderBar(); };
        col.onchange = e=>{ p.color = e.target.value; save(); renderBar(); };
        rem.onclick = ()=>{
            const idxGlobal = appState.platforms.findIndex(pp=>pp===p);
            if(idxGlobal>-1){ appState.platforms.splice(idxGlobal,1); save(); renderPlatforms(); renderBar(); }
        };
        list.appendChild(i);
    });
}

// ---------- INIT ----------
bindControls();
renderPlatforms();
setInterval(rotatePlatform, 5000);
renderBar();

// In OBS-only mode, you can hide the panel automatically
if(appState.isObs){ document.getElementById("panel").style.display="none"; }

</script>
</body>
</html>
